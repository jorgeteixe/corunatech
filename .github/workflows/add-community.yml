name: Add Community

on:
  issues:
    types: [opened, edited, labeled, reopened]

jobs:
  process-community:
    if: contains(github.event.issue.labels.*.name, 'add-community')
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Parse issue form
        id: issue-parser
        uses: stefanbuck/github-issue-parser@v3
        with:
          template-path: .github/ISSUE_TEMPLATE/01-add-community.yml

      - name: Validate and process community
        id: process
        uses: actions/github-script@v7
        env:
          PARSED_ISSUE: ${{ steps.issue-parser.outputs.jsonString }}
        with:
          script: |
            const { default: script } = await import('${{ github.workspace }}/.github/scripts/parse-community.js')
            await script({github, context, core})
