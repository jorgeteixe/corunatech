---
import EventCard from './EventCard.astro'
import MonthlyCalendar from './MonthlyCalendar.astro'
import { getCollection } from 'astro:content'
import '../styles/components/Events.css'

// Get all events and communities
const allEvents = await getCollection('events')
const communities = await getCollection('communities')
const communityMap = new Map(communities.map(c => [c.id, c.data.name]))
const communityNames = Object.fromEntries(communityMap)

// Current date for comparison (build time)
const now = new Date()

// Filter events into future and past
const futureEvents = allEvents
  .filter(event => event.data.date >= now)
  .sort((a, b) => a.data.date.getTime() - b.data.date.getTime())

const pastEvents = allEvents
  .filter(event => event.data.date < now)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
---

<section class="events-section" id="eventos">
  <div class="events-container">
    <MonthlyCalendar events={allEvents} communityNames={communityNames} />
  </div>
</section>
